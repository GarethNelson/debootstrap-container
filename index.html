<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Debootstrap-container : simple way of running multiple debian containers on a (openvz) VPS" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Debootstrap-container</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/coderofsalvation/debootstrap-container">View on GitHub</a>

          <h1 id="project_title">Debootstrap-container</h1>
          <h2 id="project_tagline">simple way of running multiple debian containers on a (openvz) VPS</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/coderofsalvation/debootstrap-container/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/coderofsalvation/debootstrap-container/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="debootstrap-container" class="anchor" href="#debootstrap-container"><span class="octicon octicon-link"></span></a>debootstrap-container</h1>

<p>simple way of running multiple debian containers on a (openvz) VPS </p>

<h3>
<a name="howto" class="anchor" href="#howto"><span class="octicon octicon-link"></span></a>Howto</h3>

<pre><code>$ sudo adduser myusername
$ sudo debootstrap-container add mycontainer
enter user which should be 'root'? myusername
redirect user into container upon ssh-login? (y/n) y
[x] created container '/srv/containers/flop'
$ ssh myusername@localhost
root@mycontainer# whoami
root@mycontainer# root
root@mycontainer# apt-get install python2
root@mycontainer# exit
</code></pre>

<p>now the funpart is: python2 is only installed in the container.
removing /srv/containers means all packages in the container are removed as well.</p>

<p>If you are only interested in local development, you can easily access the container locally as well:</p>

<pre><code>$ whoami 
myusername
$ debootstrap-container run /srv/containers/foo
root@mycontainer# whoami
root@mycontainer# root
</code></pre>

<p>Or how about exporting our container to a tarball</p>

<pre><code>$ debootstrap-container export /src/containers/mycontainer /tmp/mycontainer.tar.bz2
[x] analyzing additional installed packages + backing up dirs: srv etc opt
[x] written /tmp/mycontainer.tar.gz
</code></pre>

<p>Only the newly installed packagenames + some dirs are in the tar (instead of the whole rootfilesystem).
Lets overwrite our container with an exported tarball:</p>

<pre><code>$ debootstrap-container import /src/containers/mycontainer /tmp/mycontainer.tar.bz2  # overwrites container
[x] Reading package lists...
[x] Building dependency tree...
[x] The following extra packages will be installed:
[x] python2 
</code></pre>

<p>Or simple start a fresh container 'mycontainer2' based on our exported tarball:</p>

<pre><code>$ debootstrap-container import /src/containers/mycontainer2 /tmp/mycontainer.tar.bz2 # creates clone
[x] Reading package lists...
[x] Building dependency tree...
[x] The following extra packages will be installed:
[x] python2 
[x] done
$ ssh mycontainer2@localhost
root@mycontainer# whoami (..and so on..)
</code></pre>

<h3>
<a name="why" class="anchor" href="#why"><span class="octicon octicon-link"></span></a>Why</h3>

<p>I am a huge fan of <a href="http://docker.io">docker</a> but unfortunately I had to do multiple projects inside one VPS server.
I could not get docker working, and solutions like <a href="https://github.com/jpetazzo/sekexe">sekexe</a> or jailkit pointed into more possible hassle.
I had to go another road to satisfy my needs:</p>

<ul>
<li>I want to install packages in a container, <em>outside</em> the real host</li>
<li>I want to easily import, export, delete containers</li>
<li>I want to run node- or apache/lighttpd applications in a container</li>
<li>I want to ssh to a container and feel like I have root-access</li>
<li>I want to be somewhat compatible with docker</li>
<li>I want dont want to waste diskspace (bare debootstrap container is 124mb)</li>
</ul><h3>
<a name="docker-compatibility" class="anchor" href="#docker-compatibility"><span class="octicon octicon-link"></span></a>Docker compatibility</h3>

<p>It <em>should</em> be compatible with docker, just tar your jail-dir like so:</p>

<pre><code>tar -C /srv/containers/mycontainer -c . | docker import myname/mycontainer
</code></pre>

<h3>
<a name="tip-shared-directoreis" class="anchor" href="#tip-shared-directoreis"><span class="octicon octicon-link"></span></a>TIP: shared directoreis</h3>

<p>Sharing directories across containers (originating from outside the container) can be handy.
However, avoid symbolic links since it will confuse applications when resolving absolute paths, instead mount like so:</p>

<pre><code>mount --bind /opt/somefolder /srv/containers/mycontainer/opt/somefolder
</code></pre>

<h3>
<a name="tip-persistent-containers" class="anchor" href="#tip-persistent-containers"><span class="octicon octicon-link"></span></a>TIP: persistent containers</h3>

<p>You'll notice that daemons inside containers (like lighttpd or mysql) will eventually die when a user logs off.
This is why there's the file <code>/boot.container</code> (symlink to /etc/rc.local) where you can define daemons.
Its a bit quickndirty but it looks like this:</p>

<pre><code>/etc/init.d/lighttpd restart
/etc/init.d/mysql restart

# quickndirty to let process wait forever
while true; do sleep 1000000; done
</code></pre>

<p>Then make sure you run the following (as the container user):</p>

<pre><code>$ su myusername -c "nohup debootstrap-container run /srv/containers/lemon" &amp;
$ disown
</code></pre>

<p>Done! now daemons inside your container will stay alive.</p>

<h3>
<a name="conclusion" class="anchor" href="#conclusion"><span class="octicon octicon-link"></span></a>Conclusion</h3>

<p>This is definately not secure or as cool as docker, but it is an tidy way to deploy
applications on a openvz container (which doesnt run docker).</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Debootstrap-container maintained by <a href="https://github.com/coderofsalvation">coderofsalvation</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
